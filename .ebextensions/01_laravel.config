option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/99_composer_install.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      cd /var/app/staging
      sudo -u webapp composer install --no-dev --optimize-autoloader --no-interaction

container_commands:
  01_storage_permissions:
    command: "mkdir -p storage/framework/{sessions,views,cache,testing} storage/logs bootstrap/cache && chmod -R 777 storage bootstrap/cache"
  02_migrate:
    command: "php artisan migrate --force"
    leader_only: true
  03_cache:
    command: "php artisan config:cache && php artisan route:cache"